<%- include('layouts/header') %>

<!-- Breadcrumb Start -->
<div class="container-fluid">
  <div class="row px-3 px-sm-5 px-xl-5">
    <div class="col-12">
      <nav class="breadcrumb bg-light mb-4">
        <a class="breadcrumb-item text-dark" href="/">Home</a>
        <span class="breadcrumb-item active"><%= products.product_name %></span>
      </nav>
    </div>
  </div>
</div>
<!-- Breadcrumb End -->

<!-- Shop Detail Start -->
<div class="container-fluid pb-5">
  <div class="row px-3 px-sm-5 px-xl-5">

    <!-- Product Images -->
    <div class="col-lg-5 mb-4 mb-lg-0">
      <div id="product-carousel" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner bg-light">
          <% if (products.images[0].url.length > 0) { 
               products.images[0].url.forEach((img, i) => { %>
            <div class="carousel-item <%= i === 0 ? 'active' : '' %>">
              <img src="<%= img %>" class="d-block w-100 img-fluid"
                id="productImg-main" style="height:375px; object-fit:scale-down" alt="Product Image">
            </div>
          <% }) } %>
        </div>

        <a class="carousel-control-prev" href="#product-carousel" data-slide="prev">
          <i class="fa fa-2x fa-angle-left text-dark"></i>
        </a>
        <a class="carousel-control-next" href="#product-carousel" data-slide="next">
          <i class="fa fa-2x fa-angle-right text-dark"></i>
        </a>
      </div>
    </div>

    <!-- Product Info -->
    <div class="col-lg-7">
      <div class="bg-light p-4 p-lg-5 h-100">

        <h3><%= products.product_name %></h3>
        <input type="hidden" name="product-id" value="<%= products._id %>">

        <h4 class="font-weight-semi-bold mb-3 text-success">
          Rs. <%= products.price - products.discount %>
        </h4>
        <input type="hidden" id="price" value="<%= products.price - products.discount %>">

        <p class="mb-4"><%= products.description %></p>

        <% if(variations) { %>
                  <% variations.variation.forEach(function(variation){ %>
                    <% if(variation.type != 'Color'){  %>
                      <div class="d-flex flex-wrap mb-3">
                    
                      <strong class="text-dark mr-3" id="variation_type"><%= variation.type %> :</strong>
                      
                      <input type="hidden" name="variation_type[]" value="<%= variation.type %>">
                      
                        <%
                          variation.values.forEach((value,index)=>{   
                        %>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" class="custom-control-input" id="<%= variation.type %>-<%= index %>" name="<%= variation.type %>" <%= index == 0 ? 'checked' : '' %>>
                            <label class="custom-control-label" for="<%= variation.type %>-<%= index %>"><%= value %></label>
                        </div>
                        <%  }) %>
                     
                    </div>
                  <% } %>
                <% }) %>
              <% } %>
                <!-- Colors -->
                <% if(variations) { %>
                  <% variations.variation.forEach(function(variation){ %>
                    <% if(variation.type == 'Color'){  %>
                      <div class="d-flex mb-4">
                        <strong class="text-dark mr-3"><%= variation.type %> :</strong>
                        <div class="d-flex flex-wrap">
                          <%
                            variation.values.forEach((value,index)=>{   
                          %>
                        <div class="custom-control custom-radio custom-control-inline mb-2">
                            <input type="radio" class="custom-control-input" id="<%= variation.type %>-<%= index %>" name="<%= variation.type %>" <%= index == 0 ? 'checked' : '' %>>
                            <label class="custom-control-label" for="<%= variation.type %>-<%= index %>" style="background-color: <%= value %>;width: 24px;border:1px solid;border-radius:50%;"></label>
                        </div>
                        <%  }) %>
                       </div>
                   </div>
                <% } %>
              <% }) %>
            <% } %>

        <!-- Stock -->
        <div class="mb-3">
          <strong>Stock :</strong>
          <% if (products.stock > 0) { %>
            <span class="text-success"><%= products.stock %></span>
          <% } else { %>
            <span class="text-danger">Out of stock</span>
          <% } %>
        </div>

        <!-- Quantity + Buttons -->
        <div class="d-flex flex-wrap align-items-center mb-4">
          <div class="input-group quantity mr-3 mb-2 border border-primary qty-btns" style="width:130px">
            <div class="input-group-btn">
              <button class="btn btn-primary btn-minus">
                <i class="fa fa-minus"></i>
              </button>
            </div>
            <input type="text"
                   class="form-control bg-secondary border-0 text-center"
                   id="qty" value="1">
            <div class="input-group-btn">
              <button class="btn btn-primary btn-plus">
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
         <div class="productBtns">
            <button class="btn btn-primary mr-2 mb-2" onclick="buynow()">
              <i class="fa fa-shopping-bag mr-1"></i> Buy Now
            </button>

            <button class="btn btn-outline-primary mb-2" onclick="addtocart()">
              <i class="fa fa-shopping-cart mr-1"></i> Add To Cart
            </button>
          </div>
        </div>

        <input type="hidden" id="productId" value="<%= products._id %>">
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="row px-3 px-sm-5 px-xl-5 mt-4">
    <div class="col-12">
      <div class="bg-light p-4">
        <div class="nav nav-tabs mb-3">
          <a class="nav-item nav-link active" data-toggle="tab" href="#tab-pane-1">Description</a>
          <a class="nav-item nav-link" data-toggle="tab" href="#tab-pane-2">Information</a>
        </div>

        <div class="tab-content">
          <div class="tab-pane fade show active" id="tab-pane-1">
            <p><%= products.description %></p>
          </div>
          <div class="tab-pane fade" id="tab-pane-2">
            <ul>
              <li>Material: Cotton & Polyester</li>
              <li>Fit: Regular</li>
              <li>Season: Winter</li>
              <li>Wash Care: Machine Wash</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Info Cards Start -->
<div class="row px-xl-5 mt-4">

    <!-- Product Specifications -->
    <div class="col-lg-6 mb-30">
        <div class="bg-light p-30 h-100">
            <h5 class="mb-4 border-bottom pb-2">
                <i class="fa fa-info-circle text-primary mr-2"></i>Product Specifications
            </h5>

            <div class="row mb-3">
                <div class="col-6 text-muted">SKU</div>
                <div class="col-6 font-weight-bold"><%= products.sku %></div>
            </div>

            <div class="row mb-3">
                <div class="col-6 text-muted">Brand</div>
                <div class="col-6 font-weight-bold"><%= products.brand_name %></div>
            </div>

            <div class="row mb-3">
                <div class="col-6 text-muted">Category</div>
                <% categories.forEach((category)=>{ 
                    if(String(products.category_id) == String(category._id)){
                %>
                  <div class="col-6 font-weight-bold"><%= category.category_name %></div>
                <% }}) %>
            </div>

            <div class="row mb-3">
                <div class="col-6 text-muted">Availability</div>
                <div class="col-6">
                    <% if(products.stock > 0) { %>
                       <span class="badge badge-success px-3 py-1">In Stock</span>
                    <% }else{ %>
                        <span class="badge badge-danger px-3 py-1">Out of Stock</span>
                    <% } %>    
                </div>
            </div>

            <div class="row">
                <div class="col-6 text-muted">Tags</div>
                <div class="col-6">
                    <% const tag = products.tags.split(',') 
                        tag.forEach((tags)=>{

                        
                    %>
                    
                    <span class="badge badge-secondary mr-1"><%= tags %></span>
                    <% }) %>
                    <!-- <span class="badge badge-secondary mr-1">Winter</span>
                    <span class="badge badge-secondary">Men</span> -->
                </div>
            </div>
        </div>
    </div>

    <!-- Shipping & Trust Info -->
    <div class="col-lg-6 mb-30">
        <div class="bg-light p-30 h-100">
            <h5 class="mb-4 border-bottom pb-2">
                <i class="fa fa-shipping-fast text-primary mr-2"></i>Shipping & Returns
            </h5>

            <div class="d-flex align-items-center mb-3">
                <i class="fa fa-truck text-primary fa-lg mr-3"></i>
                <span>Free shipping on orders over <strong>$100</strong></span>
            </div>

            <div class="d-flex align-items-center mb-3">
                <i class="fa fa-clock text-primary fa-lg mr-3"></i>
                <span>Delivery within <strong>3â€“5 business days</strong></span>
            </div>

            <div class="d-flex align-items-center mb-3">
                <i class="fa fa-sync-alt text-primary fa-lg mr-3"></i>
                <span><strong>14-day</strong> easy return policy</span>
            </div>

            <div class="d-flex align-items-center">
                <i class="fa fa-lock text-primary fa-lg mr-3"></i>
                <span>100% secure payment guarantee</span>
            </div>

            <!-- Trust Badges -->
            <div class="d-flex mt-4">
                <span class="badge badge-light border mr-2 px-3 py-2">
                    <i class="fa fa-check text-success mr-1"></i>Quality Checked
                </span>
                <!-- <span class="badge badge-light border px-3 py-2">
                    <i class="fa fa-shield-alt text-success mr-1"></i>Buyer Protection
                </span> -->
            </div>
        </div>
    </div>
</div>

  <!-- Related Products -->
   <div class="container-fluid py-5">
    <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4">
        <span class="bg-secondary pr-3">Related Products</span>
    </h2>

    <div class="row px-xl-5">
      <div class="col">
        <div class="owl-carousel related-carousel">
          <% relatedProducts.forEach(p => {
               if (String(p._id) !== String(products._id)) { %>
            <div class="product-item bg-light">
              <img src="<%= p.images[0].url[0] %>"
                   class="img-fluid w-100"
                   style="height:250px;object-fit:scale-down">
              <div class="text-center py-3">
                <a href="/product-detail/<%= p.slug %>"
                   class="h6 text-decoration-none text-truncate d-block">
                  <%= p.product_name %>
                </a>
                <h6>Rs. <%= p.price %></h6>
              </div>
            </div>
          <% } }) %>
        </div>
      </div>
    </div>
  </div>

   <div class="container-fluid py-5">
    <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4">
        <span class="bg-secondary pr-3">Featured Products</span>
    </h2>

    <div class="row px-xl-5">
      <div class="col">
        <div class="owl-carousel related-carousel">
          <% featuredProducts.forEach(p => {
               if (String(p._id) !== String(products._id)) { %>
            <div class="product-item bg-light">
              <img src="<%= p.images[0].url[0] %>"
                   class="img-fluid w-100"
                   style="height:250px;object-fit:scale-down">
              <div class="text-center py-3">
                <a href="/product-detail/<%= p.slug %>"
                   class="h6 text-decoration-none text-truncate d-block">
                  <%= p.product_name %>
                </a>
                <h6>Rs. <%= p.price %></h6>
              </div>
            </div>
          <% } }) %>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('layouts/footer') %>
